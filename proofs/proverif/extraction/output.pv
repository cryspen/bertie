(*****************************************)
(* Preamble *)
(*****************************************)

channel c.
fun int2bitstring(nat): bitstring.
type err.
fun construct_fail() : err
reduc construct_fail() = fail.


(*****************************************)
(* Types and Constructors *)
(*****************************************)

type bertie__tls13handshake__t_ClientPostClientHello.
fun bertie__tls13handshake__t_ClientPostClientHello_to_bitstring(
  bertie__tls13handshake__t_ClientPostClientHello
): bitstring [typeConverter].
fun bertie__tls13handshake__ClientPostClientHello_c(
  bertie__tls13utils__t_Bytes,
  bertie__tls13crypto__t_Algorithms,
  bertie__tls13utils__t_Bytes,
  core__option__t_Option_of_bertie__tls13utils__t_Bytes,
  bertie__tls13formats__t_Transcript
): bertie__tls13handshake__t_ClientPostClientHello [data].
reduc forall 
  bertie__tls13handshake__ClientPostClientHello_0: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_1: bertie__tls13crypto__t_Algorithms,
  bertie__tls13handshake__ClientPostClientHello_2: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_3: core__option__t_Option_of_bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_4: bertie__tls13formats__t_Transcript
;
    accessor_bertie__tls13handshake__ClientPostClientHello_0(
      bertie__tls13handshake__ClientPostClientHello_c(
        bertie__tls13handshake__ClientPostClientHello_0,
        bertie__tls13handshake__ClientPostClientHello_1,
        bertie__tls13handshake__ClientPostClientHello_2,
        bertie__tls13handshake__ClientPostClientHello_3,
        bertie__tls13handshake__ClientPostClientHello_4
      )
    ) = bertie__tls13handshake__ClientPostClientHello_0.
reduc forall 
  bertie__tls13handshake__ClientPostClientHello_0: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_1: bertie__tls13crypto__t_Algorithms,
  bertie__tls13handshake__ClientPostClientHello_2: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_3: core__option__t_Option_of_bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_4: bertie__tls13formats__t_Transcript
;
    accessor_bertie__tls13handshake__ClientPostClientHello_1(
      bertie__tls13handshake__ClientPostClientHello_c(
        bertie__tls13handshake__ClientPostClientHello_0,
        bertie__tls13handshake__ClientPostClientHello_1,
        bertie__tls13handshake__ClientPostClientHello_2,
        bertie__tls13handshake__ClientPostClientHello_3,
        bertie__tls13handshake__ClientPostClientHello_4
      )
    ) = bertie__tls13handshake__ClientPostClientHello_1.
reduc forall 
  bertie__tls13handshake__ClientPostClientHello_0: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_1: bertie__tls13crypto__t_Algorithms,
  bertie__tls13handshake__ClientPostClientHello_2: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_3: core__option__t_Option_of_bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_4: bertie__tls13formats__t_Transcript
;
    accessor_bertie__tls13handshake__ClientPostClientHello_2(
      bertie__tls13handshake__ClientPostClientHello_c(
        bertie__tls13handshake__ClientPostClientHello_0,
        bertie__tls13handshake__ClientPostClientHello_1,
        bertie__tls13handshake__ClientPostClientHello_2,
        bertie__tls13handshake__ClientPostClientHello_3,
        bertie__tls13handshake__ClientPostClientHello_4
      )
    ) = bertie__tls13handshake__ClientPostClientHello_2.
reduc forall 
  bertie__tls13handshake__ClientPostClientHello_0: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_1: bertie__tls13crypto__t_Algorithms,
  bertie__tls13handshake__ClientPostClientHello_2: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_3: core__option__t_Option_of_bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_4: bertie__tls13formats__t_Transcript
;
    accessor_bertie__tls13handshake__ClientPostClientHello_3(
      bertie__tls13handshake__ClientPostClientHello_c(
        bertie__tls13handshake__ClientPostClientHello_0,
        bertie__tls13handshake__ClientPostClientHello_1,
        bertie__tls13handshake__ClientPostClientHello_2,
        bertie__tls13handshake__ClientPostClientHello_3,
        bertie__tls13handshake__ClientPostClientHello_4
      )
    ) = bertie__tls13handshake__ClientPostClientHello_3.
reduc forall 
  bertie__tls13handshake__ClientPostClientHello_0: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_1: bertie__tls13crypto__t_Algorithms,
  bertie__tls13handshake__ClientPostClientHello_2: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_3: core__option__t_Option_of_bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostClientHello_4: bertie__tls13formats__t_Transcript
;
    accessor_bertie__tls13handshake__ClientPostClientHello_4(
      bertie__tls13handshake__ClientPostClientHello_c(
        bertie__tls13handshake__ClientPostClientHello_0,
        bertie__tls13handshake__ClientPostClientHello_1,
        bertie__tls13handshake__ClientPostClientHello_2,
        bertie__tls13handshake__ClientPostClientHello_3,
        bertie__tls13handshake__ClientPostClientHello_4
      )
    ) = bertie__tls13handshake__ClientPostClientHello_4.

type bertie__tls13handshake__t_ClientPostServerHello.
fun bertie__tls13handshake__t_ClientPostServerHello_to_bitstring(
  bertie__tls13handshake__t_ClientPostServerHello
): bitstring [typeConverter].
fun bertie__tls13handshake__ClientPostServerHello_c(
  bertie__tls13utils__t_Bytes,
  bertie__tls13utils__t_Bytes,
  bertie__tls13crypto__t_Algorithms,
  bertie__tls13utils__t_Bytes,
  bertie__tls13utils__t_Bytes,
  bertie__tls13utils__t_Bytes,
  bertie__tls13formats__t_Transcript
): bertie__tls13handshake__t_ClientPostServerHello [data].
reduc forall 
  bertie__tls13handshake__ClientPostServerHello_0: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_1: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_2: bertie__tls13crypto__t_Algorithms,
  bertie__tls13handshake__ClientPostServerHello_3: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_4: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_5: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_6: bertie__tls13formats__t_Transcript
;
    accessor_bertie__tls13handshake__ClientPostServerHello_0(
      bertie__tls13handshake__ClientPostServerHello_c(
        bertie__tls13handshake__ClientPostServerHello_0,
        bertie__tls13handshake__ClientPostServerHello_1,
        bertie__tls13handshake__ClientPostServerHello_2,
        bertie__tls13handshake__ClientPostServerHello_3,
        bertie__tls13handshake__ClientPostServerHello_4,
        bertie__tls13handshake__ClientPostServerHello_5,
        bertie__tls13handshake__ClientPostServerHello_6
      )
    ) = bertie__tls13handshake__ClientPostServerHello_0.
reduc forall 
  bertie__tls13handshake__ClientPostServerHello_0: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_1: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_2: bertie__tls13crypto__t_Algorithms,
  bertie__tls13handshake__ClientPostServerHello_3: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_4: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_5: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_6: bertie__tls13formats__t_Transcript
;
    accessor_bertie__tls13handshake__ClientPostServerHello_1(
      bertie__tls13handshake__ClientPostServerHello_c(
        bertie__tls13handshake__ClientPostServerHello_0,
        bertie__tls13handshake__ClientPostServerHello_1,
        bertie__tls13handshake__ClientPostServerHello_2,
        bertie__tls13handshake__ClientPostServerHello_3,
        bertie__tls13handshake__ClientPostServerHello_4,
        bertie__tls13handshake__ClientPostServerHello_5,
        bertie__tls13handshake__ClientPostServerHello_6
      )
    ) = bertie__tls13handshake__ClientPostServerHello_1.
reduc forall 
  bertie__tls13handshake__ClientPostServerHello_0: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_1: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_2: bertie__tls13crypto__t_Algorithms,
  bertie__tls13handshake__ClientPostServerHello_3: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_4: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_5: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_6: bertie__tls13formats__t_Transcript
;
    accessor_bertie__tls13handshake__ClientPostServerHello_2(
      bertie__tls13handshake__ClientPostServerHello_c(
        bertie__tls13handshake__ClientPostServerHello_0,
        bertie__tls13handshake__ClientPostServerHello_1,
        bertie__tls13handshake__ClientPostServerHello_2,
        bertie__tls13handshake__ClientPostServerHello_3,
        bertie__tls13handshake__ClientPostServerHello_4,
        bertie__tls13handshake__ClientPostServerHello_5,
        bertie__tls13handshake__ClientPostServerHello_6
      )
    ) = bertie__tls13handshake__ClientPostServerHello_2.
reduc forall 
  bertie__tls13handshake__ClientPostServerHello_0: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_1: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_2: bertie__tls13crypto__t_Algorithms,
  bertie__tls13handshake__ClientPostServerHello_3: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_4: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_5: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_6: bertie__tls13formats__t_Transcript
;
    accessor_bertie__tls13handshake__ClientPostServerHello_3(
      bertie__tls13handshake__ClientPostServerHello_c(
        bertie__tls13handshake__ClientPostServerHello_0,
        bertie__tls13handshake__ClientPostServerHello_1,
        bertie__tls13handshake__ClientPostServerHello_2,
        bertie__tls13handshake__ClientPostServerHello_3,
        bertie__tls13handshake__ClientPostServerHello_4,
        bertie__tls13handshake__ClientPostServerHello_5,
        bertie__tls13handshake__ClientPostServerHello_6
      )
    ) = bertie__tls13handshake__ClientPostServerHello_3.
reduc forall 
  bertie__tls13handshake__ClientPostServerHello_0: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_1: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_2: bertie__tls13crypto__t_Algorithms,
  bertie__tls13handshake__ClientPostServerHello_3: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_4: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_5: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_6: bertie__tls13formats__t_Transcript
;
    accessor_bertie__tls13handshake__ClientPostServerHello_4(
      bertie__tls13handshake__ClientPostServerHello_c(
        bertie__tls13handshake__ClientPostServerHello_0,
        bertie__tls13handshake__ClientPostServerHello_1,
        bertie__tls13handshake__ClientPostServerHello_2,
        bertie__tls13handshake__ClientPostServerHello_3,
        bertie__tls13handshake__ClientPostServerHello_4,
        bertie__tls13handshake__ClientPostServerHello_5,
        bertie__tls13handshake__ClientPostServerHello_6
      )
    ) = bertie__tls13handshake__ClientPostServerHello_4.
reduc forall 
  bertie__tls13handshake__ClientPostServerHello_0: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_1: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_2: bertie__tls13crypto__t_Algorithms,
  bertie__tls13handshake__ClientPostServerHello_3: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_4: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_5: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_6: bertie__tls13formats__t_Transcript
;
    accessor_bertie__tls13handshake__ClientPostServerHello_5(
      bertie__tls13handshake__ClientPostServerHello_c(
        bertie__tls13handshake__ClientPostServerHello_0,
        bertie__tls13handshake__ClientPostServerHello_1,
        bertie__tls13handshake__ClientPostServerHello_2,
        bertie__tls13handshake__ClientPostServerHello_3,
        bertie__tls13handshake__ClientPostServerHello_4,
        bertie__tls13handshake__ClientPostServerHello_5,
        bertie__tls13handshake__ClientPostServerHello_6
      )
    ) = bertie__tls13handshake__ClientPostServerHello_5.
reduc forall 
  bertie__tls13handshake__ClientPostServerHello_0: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_1: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_2: bertie__tls13crypto__t_Algorithms,
  bertie__tls13handshake__ClientPostServerHello_3: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_4: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_5: bertie__tls13utils__t_Bytes,
  bertie__tls13handshake__ClientPostServerHello_6: bertie__tls13formats__t_Transcript
;
    accessor_bertie__tls13handshake__ClientPostServerHello_6(
      bertie__tls13handshake__ClientPostServerHello_c(
        bertie__tls13handshake__ClientPostServerHello_0,
        bertie__tls13handshake__ClientPostServerHello_1,
        bertie__tls13handshake__ClientPostServerHello_2,
        bertie__tls13handshake__ClientPostServerHello_3,
        bertie__tls13handshake__ClientPostServerHello_4,
        bertie__tls13handshake__ClientPostServerHello_5,
        bertie__tls13handshake__ClientPostServerHello_6
      )
    ) = bertie__tls13handshake__ClientPostServerHello_6.

type bertie__tls13record__t_DuplexCipherStateH.
fun bertie__tls13record__t_DuplexCipherStateH_to_bitstring(
  bertie__tls13record__t_DuplexCipherStateH
): bitstring [typeConverter].
fun bertie__tls13record__DuplexCipherStateH_c(
  bertie__tls13crypto__t_AeadKeyIV,
  bitstring,
  bertie__tls13crypto__t_AeadKeyIV,
  bitstring
): bertie__tls13record__t_DuplexCipherStateH [data].
reduc forall 
  bertie__tls13record__DuplexCipherStateH_f_sender_key_iv: bertie__tls13crypto__t_AeadKeyIV,
  bertie__tls13record__DuplexCipherStateH_f_sender_counter: bitstring,
  bertie__tls13record__DuplexCipherStateH_f_receiver_key_iv: bertie__tls13crypto__t_AeadKeyIV,
  bertie__tls13record__DuplexCipherStateH_f_receiver_counter: bitstring
;
    accessor_bertie__tls13record__DuplexCipherStateH_f_sender_key_iv(
      bertie__tls13record__DuplexCipherStateH_c(
        bertie__tls13record__DuplexCipherStateH_f_sender_key_iv,
        bertie__tls13record__DuplexCipherStateH_f_sender_counter,
        bertie__tls13record__DuplexCipherStateH_f_receiver_key_iv,
        bertie__tls13record__DuplexCipherStateH_f_receiver_counter
      )
    ) = bertie__tls13record__DuplexCipherStateH_f_sender_key_iv.
reduc forall 
  bertie__tls13record__DuplexCipherStateH_f_sender_key_iv: bertie__tls13crypto__t_AeadKeyIV,
  bertie__tls13record__DuplexCipherStateH_f_sender_counter: bitstring,
  bertie__tls13record__DuplexCipherStateH_f_receiver_key_iv: bertie__tls13crypto__t_AeadKeyIV,
  bertie__tls13record__DuplexCipherStateH_f_receiver_counter: bitstring
;
    accessor_bertie__tls13record__DuplexCipherStateH_f_sender_counter(
      bertie__tls13record__DuplexCipherStateH_c(
        bertie__tls13record__DuplexCipherStateH_f_sender_key_iv,
        bertie__tls13record__DuplexCipherStateH_f_sender_counter,
        bertie__tls13record__DuplexCipherStateH_f_receiver_key_iv,
        bertie__tls13record__DuplexCipherStateH_f_receiver_counter
      )
    ) = bertie__tls13record__DuplexCipherStateH_f_sender_counter.
reduc forall 
  bertie__tls13record__DuplexCipherStateH_f_sender_key_iv: bertie__tls13crypto__t_AeadKeyIV,
  bertie__tls13record__DuplexCipherStateH_f_sender_counter: bitstring,
  bertie__tls13record__DuplexCipherStateH_f_receiver_key_iv: bertie__tls13crypto__t_AeadKeyIV,
  bertie__tls13record__DuplexCipherStateH_f_receiver_counter: bitstring
;
    accessor_bertie__tls13record__DuplexCipherStateH_f_receiver_key_iv(
      bertie__tls13record__DuplexCipherStateH_c(
        bertie__tls13record__DuplexCipherStateH_f_sender_key_iv,
        bertie__tls13record__DuplexCipherStateH_f_sender_counter,
        bertie__tls13record__DuplexCipherStateH_f_receiver_key_iv,
        bertie__tls13record__DuplexCipherStateH_f_receiver_counter
      )
    ) = bertie__tls13record__DuplexCipherStateH_f_receiver_key_iv.
reduc forall 
  bertie__tls13record__DuplexCipherStateH_f_sender_key_iv: bertie__tls13crypto__t_AeadKeyIV,
  bertie__tls13record__DuplexCipherStateH_f_sender_counter: bitstring,
  bertie__tls13record__DuplexCipherStateH_f_receiver_key_iv: bertie__tls13crypto__t_AeadKeyIV,
  bertie__tls13record__DuplexCipherStateH_f_receiver_counter: bitstring
;
    accessor_bertie__tls13record__DuplexCipherStateH_f_receiver_counter(
      bertie__tls13record__DuplexCipherStateH_c(
        bertie__tls13record__DuplexCipherStateH_f_sender_key_iv,
        bertie__tls13record__DuplexCipherStateH_f_sender_counter,
        bertie__tls13record__DuplexCipherStateH_f_receiver_key_iv,
        bertie__tls13record__DuplexCipherStateH_f_receiver_counter
      )
    ) = bertie__tls13record__DuplexCipherStateH_f_receiver_counter.

(*****************************************)
(* Functions *)
(*****************************************)

letfun bertie__tls13handshake__derive_secret(
         hash_algorithm : bertie__tls13crypto__t_HashAlgorithm,
         key : bertie__tls13utils__t_Bytes,
         label : bertie__tls13utils__t_Bytes,
         transcript_hash : bertie__tls13utils__t_Bytes
       ) =
       accessor_bertie__tls13handshake__hkdf_expand_label(
         hash_algorithm,
         key,
         label,
         transcript_hash,
         accessor_bertie__tls13crypto__impl__HashAlgorithm__hash_len(
           hash_algorithm
         )
       ).

letfun bertie__tls13handshake__hash_empty(
         algorithm : bertie__tls13crypto__t_HashAlgorithm
       ) =
       accessor_bertie__tls13crypto__impl__HashAlgorithm__hash(
         algorithm, accessor_bertie__tls13utils__impl__Bytes__new(())
       ).

letfun bertie__tls13handshake__derive_aead_key_iv(
         hash_algorithm : bertie__tls13crypto__t_HashAlgorithm,
         aead_algorithm : bertie__tls13crypto__t_AeadAlgorithm,
         key : bertie__tls13utils__t_Bytes
       ) =
       let sender_write_key =
         bertie__tls13handshake__hkdf_expand_label(
           hash_algorithm,
           key,
           accessor_bertie__tls13utils__bytes(
             accessor_rust_primitives__unsize(bertie__tls13formats__v_LABEL_KEY)
           ),
           accessor_bertie__tls13utils__impl__Bytes__new(()),
           accessor_bertie__tls13crypto__impl__AeadAlgorithm__key_len(
             aead_algorithm
           )
         )
        in
       let sender_write_iv =
         bertie__tls13handshake__hkdf_expand_label(
           hash_algorithm,
           key,
           accessor_bertie__tls13utils__bytes(
             accessor_rust_primitives__unsize(bertie__tls13formats__v_LABEL_IV)
           ),
           accessor_bertie__tls13utils__impl__Bytes__new(()),
           accessor_bertie__tls13crypto__impl__AeadAlgorithm__iv_len(
             aead_algorithm
           )
         )
        in
       bertie__tls13crypto__impl__AeadKeyIV__new(
         accessor_bertie__tls13crypto__impl__AeadKey__new(
           sender_write_key, aead_algorithm
         ),
         sender_write_iv
       ).

letfun bertie__tls13handshake__derive_finished_key(
         ha : bertie__tls13crypto__t_HashAlgorithm,
         k : bertie__tls13utils__t_Bytes
       ) =
       accessor_bertie__tls13handshake__hkdf_expand_label(
         ha,
         k,
         accessor_bertie__tls13utils__bytes(
           accessor_rust_primitives__unsize(
             bertie__tls13formats__v_LABEL_FINISHED
           )
         ),
         accessor_bertie__tls13utils__impl__Bytes__new(()),
         accessor_bertie__tls13crypto__impl__HashAlgorithm__hmac_tag_len(ha)
       ).

letfun bertie__tls13handshake__derive_hk_ms(
         ha : bertie__tls13crypto__t_HashAlgorithm,
         ae : bertie__tls13crypto__t_AeadAlgorithm,
         shared_secret : bertie__tls13utils__t_Bytes,
         psko : core__option__t_Option_of_bertie__tls13utils__t_Bytes,
         transcript_hash : bertie__tls13utils__t_Bytes
       ) =
       let psk =
         let core__option__Option_Option_Some_c(k) = psko in accessor_core__clone__Clone_f_clone(
           k
         )
         else accessor_bertie__tls13crypto__zero_key(ha)
        in
       let early_secret =
         bertie__tls13crypto__hkdf_extract(
           ha, psk, accessor_bertie__tls13crypto__zero_key(ha)
         )
        in
       let digest_emp = bertie__tls13handshake__hash_empty(ha) in
       let derived_secret =
         bertie__tls13handshake__derive_secret(
           ha,
           early_secret,
           accessor_bertie__tls13utils__bytes(
             accessor_rust_primitives__unsize(
               bertie__tls13formats__v_LABEL_DERIVED
             )
           ),
           digest_emp
         )
        in
       let handshake_secret =
         bertie__tls13crypto__hkdf_extract(ha, shared_secret, derived_secret)
        in
       let client_handshake_traffic_secret =
         bertie__tls13handshake__derive_secret(
           ha,
           handshake_secret,
           accessor_bertie__tls13utils__bytes(
             accessor_rust_primitives__unsize(
               bertie__tls13formats__v_LABEL_C_HS_TRAFFIC
             )
           ),
           transcript_hash
         )
        in
       let server_handshake_traffic_secret =
         bertie__tls13handshake__derive_secret(
           ha,
           handshake_secret,
           accessor_bertie__tls13utils__bytes(
             accessor_rust_primitives__unsize(
               bertie__tls13formats__v_LABEL_S_HS_TRAFFIC
             )
           ),
           transcript_hash
         )
        in
       let client_finished_key =
         bertie__tls13handshake__derive_finished_key(
           ha, client_handshake_traffic_secret
         )
        in
       let server_finished_key =
         bertie__tls13handshake__derive_finished_key(
           ha, server_handshake_traffic_secret
         )
        in
       let client_write_key_iv =
         bertie__tls13handshake__derive_aead_key_iv(
           ha, ae, client_handshake_traffic_secret
         )
        in
       let server_write_key_iv =
         bertie__tls13handshake__derive_aead_key_iv(
           ha, ae, server_handshake_traffic_secret
         )
        in
       let master_secret___ =
         bertie__tls13handshake__derive_secret(
           ha,
           handshake_secret,
           accessor_bertie__tls13utils__bytes(
             accessor_rust_primitives__unsize(
               bertie__tls13formats__v_LABEL_DERIVED
             )
           ),
           digest_emp
         )
        in
       let master_secret =
         bertie__tls13crypto__hkdf_extract(
           ha, accessor_bertie__tls13crypto__zero_key(ha), master_secret___
         )
        in
       (
         client_write_key_iv,
         server_write_key_iv,
         client_finished_key,
         server_finished_key,
         master_secret
       ).

letfun bertie__tls13record__impl__DuplexCipherStateH__new(
         sender_key_iv : bertie__tls13crypto__t_AeadKeyIV,
         sender_counter : bitstring,
         receiver_key_iv : bertie__tls13crypto__t_AeadKeyIV,
         receiver_counter : bitstring
       ) =
       bertie__tls13record__DuplexCipherStateH_c(
         sender_key_iv,sender_counter,receiver_key_iv,receiver_counter
       ).

letfun bertie__tls13handshake__put_server_hello(
         handshake : bertie__tls13formats__handshake_data__t_HandshakeData,
         state : bertie__tls13handshake__t_ClientPostClientHello
       ) =
       let
         bertie__tls13handshake__ClientPostClientHello_c(
           client_random, ciphersuite, sk, psk, tx
         )
        = state in
       let (sr: bertie__tls13utils__t_Bytes, ct: bertie__tls13utils__t_Bytes) =
         bertie__tls13formats__parse_server_hello(ciphersuite, handshake)
        in
       let tx =
         accessor_bertie__tls13formats__impl__Transcript__add(tx, handshake)
        in
       let shared_secret =
         bertie__tls13crypto__kem_decap(
           accessor_bertie__tls13crypto__Algorithms_f_kem(ciphersuite), ct, sk
         )
        in
       let th = bertie__tls13formats__impl__Transcript__transcript_hash(tx) in
       let
         (
           chk: bertie__tls13crypto__t_AeadKeyIV,
           shk: bertie__tls13crypto__t_AeadKeyIV,
           cfk: bertie__tls13utils__t_Bytes,
           sfk: bertie__tls13utils__t_Bytes,
           ms: bertie__tls13utils__t_Bytes
         )
        =
         bertie__tls13handshake__derive_hk_ms(
           accessor_bertie__tls13crypto__Algorithms_f_hash(ciphersuite),
           accessor_bertie__tls13crypto__Algorithms_f_aead(ciphersuite),
           shared_secret,
           psk,
           th
         )
        in
       (
         accessor_bertie__tls13record__impl__DuplexCipherStateH__new(
           chk, 0, shk, 0
         ),
         bertie__tls13handshake__ClientPostServerHello_c(
           client_random, sr, ciphersuite, ms, cfk, sfk, tx
         )
       ).

(*****************************************)
(* Processes *)
(*****************************************)



(*****************************************)
(* Top-level process *)
(*****************************************)

process
    0


